import { describe, expect, it } from "vitest";
import { createZustandStorage, tables } from "../../test/utils";
import { logsToBlocks } from "../../test/logsToBlocks";
import worldRpcLogs10 from "../../../../test-data/world-logs-10.json";

describe("Get records with query", async () => {
  const blocks = logsToBlocks(worldRpcLogs10);

  const { useStore, storageAdapter } = createZustandStorage();

  for (const block of blocks) {
    storageAdapter(block);
  }

  it("zustand: `getRecords`", async () => {
    const records = useStore.getState().getRecords(tables.Number);

    expect(Object.keys(useStore.getState().getRecords(tables.Number)).filter((x) => x in records))
      .toMatchInlineSnapshot(`
  [
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000000",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000001",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000002",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000003",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000004",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000005",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000006",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000007",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000008",
    "0x746200000000000000000000000000004e756d62657200000000000000000000:0x0000000000000000000000000000000000000000000000000000000000000009",
  ]
  `);
  });
});
